ROCM Support(1)
===============

NAME
----
kfd_plugin - A plugin extention to CRIU to support checkpoint/restore in
userspace for AMD GPUs.


CURRENT SUPPORT
---------------
Single and Multi GPU systems (Gfx9)
Checkpoint / Restore on same system
Checkpoint / Restore inside a docker container
Pytorch

DESCRIPTION
-----------
Though *criu* is a great tool for checkpointing and restoring running
applications, it has certain limitations such as it cannot handle
applications that have device files open. In order to support *ROCm* based
workloads with *criu* we need to augment criu's core functionality with a
plugin based extention mechanism. *kfd_plugin* provides the necessary support
to criu to allow Checkpoint / Restore with ROCm.


Dependencies
~~~~~~~~~~~~~~
*amdkfd support*::
    In order to snapshot the *VRAM* and other *GPU* device states, we require
    an updated version of amdkfd(amdgpu) driver. The kernel patches are under
    review currently.

*criu 3.15*::
    This work is rebased on latest criu release available at this time.


OPTIONS
-------
Optional parameters can be passed in as environment variables before
executing criu command.

*KFD_DESTINATION_GPUS*::
    Override GPUs on local restore node. GPUs can be specified as gpu_id
    (hex or decimal) or minor number. Default:<None>

    E.g:

    KFD_DESTINATION_GPUS=0xff31,0x90db

    KFD_DESTINATION_GPUS=65329,37083

    KFD_DESTINATION_GPUS=renderD129,renderD128

*KFD_FW_VER_CHECK*::
    Enable or disable firmware version check.
    If enabled, firmware version on restored gpu needs to be greater than or
    equal firmware version on checkpointed gpu. This option is only valid if
    KFD_DESTINATION_GPUS is used. Default:Enabled

    E.g:
    KFD_FW_VER_CHECK=0

*KFD_CACHES_COUNT_CHECK*::
    Enable or disable caches count check. If enabled, the caches count on 
    restored gpu needs to be greater than or equal caches count on checkpointed
    gpu. Default:Enabled

    E.g:
    KFD_CACHES_COUNT_CHECK=0

AUTHOR
------
The AMDKFD team.


COPYRIGHT
---------
Copyright \(C) 2020-2021, Advanced Micro Devices, Inc. (AMD)
