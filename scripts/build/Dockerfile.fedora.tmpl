ARG CC=gcc

COPY scripts/ci/prepare-for-fedora-rawhide.sh /bin/prepare-for-fedora-rawhide.sh
COPY contrib/dependencies/dnf-packages.txt /tmp/dnf-packages.txt
RUN /bin/prepare-for-fedora-rawhide.sh /tmp/dnf-packages.txt && \
	rm /tmp/dnf-packages.txt

COPY . /criu
WORKDIR /criu

RUN make mrproper && date && make -j $(nproc) CC="$CC" && date

# The rpc test cases are running as user #1000, let's add the user
RUN adduser -u 1000 test

RUN make -C test/zdtm -j $(nproc)
